{% extends "base.html" %}
<div style="text-align: right; margin-top: 20px">
  <a href="{{ url_for('main.user_page', id=current_user.id) }}" class="custom-link">–í –ø—Ä–æ—Ñ–∏–ª—å</a>
</div>
{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}
{% block head %}<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>{% endblock %}
{% block content %}
<h1>üìä –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
<ul>
  <li><b>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞:</b> {{ total_revenue }} ‚ÇΩ</li>
  <li><b>–°—Ä–µ–¥–Ω—è—è —Å–¥–µ–ª–∫–∞:</b> {{ avg_deal|round(2) }} ‚ÇΩ</li>
  <li><b>–ö–ª–∏–µ–Ω—Ç–æ–≤:</b> {{ total_clients }}</li>
  <li><b>–°–¥–µ–ª–æ–∫:</b> {{ total_deals }}</li>
</ul>
<h2>üèÜ –¢–æ–ø-5 –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
<ol>{% for name, total in top_clients %}<li>{{ name }} ‚Äî {{ total|round(2) }} ‚ÇΩ</li>{% endfor %}</ol>
<h2>üìà –°–¥–µ–ª–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
<canvas id="dealsChart" width="600" height="300"></canvas>
<script>
const ctx = document.getElementById('dealsChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ month_labels|tojson }},
        datasets: [{
            label: '–°—É–º–º–∞ —Å–¥–µ–ª–æ–∫ –ø–æ –º–µ—Å—è—Ü–∞–º',
            data: {{ month_values|tojson }},
            backgroundColor: 'rgba(255,255,255,0.9)',
            borderColor: 'rgba(255,255,255,1)',
            borderWidth: 1
        }]
    },
    options: {
        plugins: { legend: { labels: { color: '#fff' } } },
        scales: {
            x: { ticks: { color: '#ccc' } },
            y: { ticks: { color: '#ccc', callback: val => val + ' ‚ÇΩ' }, beginAtZero: true }
        }
    }
});
</script>
{% endblock %}